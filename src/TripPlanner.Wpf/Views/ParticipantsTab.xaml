<UserControl x:Class="TripPlanner.Wpf.Views.ParticipantsTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:TripPlanner.Wpf.Converters">
  <UserControl.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    <conv:InverseBooleanConverter x:Key="InverseBooleanConverter"/>
    <!-- Simple pill badge style -->
    <Style x:Key="Pill" TargetType="Border">
      <Setter Property="Background" Value="#FFE8E8E8"/>
      <Setter Property="Padding" Value="4,2"/>
      <Setter Property="CornerRadius" Value="10"/>
      <Setter Property="Margin" Value="0,0,6,0"/>
    </Style>
  </UserControl.Resources>

  <DockPanel Margin="10">

    <!-- Header: Organizer info -->
    <TextBlock DockPanel.Dock="Top"
               Text="{Binding OrganizerDisplay}"
               FontWeight="SemiBold"
               Margin="0,0,0,8"/>

    <!-- Participants list, read-only for non-organizers -->
    <ListView ItemsSource="{Binding Items}">
      <ListView.ItemTemplate>
        <DataTemplate>
          <DockPanel LastChildFill="False" Margin="0,4">

            <!-- Right-side action buttons (organizer-only) -->
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
              <Button Content="Remove"
                      Visibility="{Binding CanRemove, Converter={StaticResource BoolToVis}}"
                      Command="{Binding DataContext.RemoveCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      CommandParameter="{Binding}"
                      Margin="6,0,0,0"/>
              <Button Content="Save name"
                      Visibility="{Binding CanRename, Converter={StaticResource BoolToVis}}"
                      Command="{Binding DataContext.RenameCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                      CommandParameter="{Binding}"
                      Margin="6,0,0,0"/>
            </StackPanel>

            <!-- Left-side identity -->
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
              <!-- Badges -->
              <Border Style="{StaticResource Pill}" Background="#FFDDEEFF"
                      Visibility="{Binding IsOrganizer, Converter={StaticResource BoolToVis}}">
                <TextBlock Text="Organizer" FontSize="11"/>
              </Border>
              <Border Style="{StaticResource Pill}">
                <TextBlock Text="{Binding RoleBadge}" FontSize="11"/>
              </Border>

              <!-- Placeholder name: editable only if organizer -->
              <TextBox Width="240" Margin="8,0,0,0"
                       Text="{Binding DisplayName, UpdateSourceTrigger=PropertyChanged}"
                       IsReadOnly="{Binding CanRename, Converter={StaticResource InverseBooleanConverter}}"
                       Visibility="{Binding IsPlaceholder, Converter={StaticResource BoolToVis}}"/>

              <!-- Real user: show username + optional display name -->
              <StackPanel Orientation="Horizontal" Margin="8,0,0,0"
                          Visibility="{Binding IsRealUser, Converter={StaticResource BoolToVis}}">
                <TextBlock Text="{Binding DisplayPrimary}" FontWeight="SemiBold"/>
                <TextBlock Text="{Binding DisplaySecondary, StringFormat=  •  {0}}" Foreground="Gray"/>
              </StackPanel>

              <!-- Technical id (dim) -->
              <TextBlock Text="{Binding ParticipantId}" Foreground="Gray" Margin="12,0,0,0" VerticalAlignment="Center"/>
            </StackPanel>

          </DockPanel>
        </DataTemplate>
      </ListView.ItemTemplate>
    </ListView>
  </DockPanel>
</UserControl>
