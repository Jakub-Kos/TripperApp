<Window x:Class="TripPlanner.Wpf.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="TripPlanner" Height="620" Width="980"
        x:Name="Root">
  <DockPanel>
    <!-- Menu bar -->
    <Menu DockPanel.Dock="Top">
      <MenuItem Header="_Account">
        <MenuItem Header="Sign out" Click="OnSignOut"/>
      </MenuItem>
    </Menu>
    <Grid Margin="12">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>
      
      <!-- Create / Join trip -->
      <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
        <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,6,0"/>
        <TextBox Width="200" Text="{Binding NewTripName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
        <Button Content="Create Trip" Command="{Binding CreateTripCommand}" />
        
        <Button Content="Refresh" Command="{Binding RefreshCommand}" Margin="8,0,0,0"/>
        <CheckBox Content="Include finished trips" IsChecked="{Binding IncludeFinished}" Margin="12,0,0,0" VerticalAlignment="Center"/>
        <TextBlock Text="{Binding Status}" Margin="12,0,0,0" VerticalAlignment="Center" Foreground="DarkSlateGray"/>
      </StackPanel>

      <!-- List + Details -->
      <Grid Grid.Row="1">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- Trips -->
        <DataGrid Grid.Column="0" ItemsSource="{Binding Trips}" SelectedItem="{Binding SelectedTrip}"
                  AutoGenerateColumns="False" IsReadOnly="True" Margin="0,0,8,0">
          <DataGrid.RowStyle>
            <Style TargetType="DataGridRow">
              <Setter Property="Foreground" Value="Black"/>
              <Style.Triggers>
                <DataTrigger Binding="{Binding IsFinished}" Value="True">
                  <Setter Property="Foreground" Value="Green"/>
                </DataTrigger>
              </Style.Triggers>
            </Style>
          </DataGrid.RowStyle>
          <DataGrid.Columns>
            <DataGridTemplateColumn Header="Trip">
              <DataGridTemplateColumn.CellTemplate>
                <DataTemplate>
                  <StackPanel>
                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding DescriptionSnippet}" FontSize="12" Foreground="Gray" TextTrimming="CharacterEllipsis"/>
                  </StackPanel>
                </DataTemplate>
              </DataGridTemplateColumn.CellTemplate>
            </DataGridTemplateColumn>
          </DataGrid.Columns>
        </DataGrid>

        <!-- Right panel -->
        <TabControl Grid.Column="1"
                    SelectedIndex="{Binding SelectedSectionIndex}">

          <TabItem Header="Overview">
            <Grid>
              <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
              </Grid.RowDefinitions>

              <!-- Header with Edit/Cancel -->
              <DockPanel Grid.Row="0">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                  <TextBlock Text="Trip Overview" FontWeight="Bold" FontSize="16"/>
                  <TextBlock Text="{Binding SelectedSummary.Name}" FontSize="14" Margin="8,2,0,0"/>
                </StackPanel>

                <!-- Edit button when not editing -->
                <Button Content="Edit" Command="{Binding EnterEditOverviewCommand}" DockPanel.Dock="Right">
                  <Button.Style>
                    <Style TargetType="Button">
                      <Setter Property="Visibility" Value="Collapsed"/>
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding IsEditingOverview}" Value="False">
                          <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </Button.Style>
                </Button>
                <!-- Cancel button when editing -->
                <Button Content="Cancel" Command="{Binding CancelEditOverviewCommand}" DockPanel.Dock="Right" Margin="8,0,0,0">
                  <Button.Style>
                    <Style TargetType="Button">
                      <Setter Property="Visibility" Value="Collapsed"/>
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding IsEditingOverview}" Value="True">
                          <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </Button.Style>
                </Button>
              </DockPanel>

              <!-- Content -->
              <StackPanel Grid.Row="1">
                <TextBlock Text="Participants" FontWeight="SemiBold"/>
                <ItemsControl ItemsSource="{Binding SelectedSummary.Participants}">
                  <ItemsControl.ItemTemplate>
                    <DataTemplate><TextBlock Text="{Binding}"/></DataTemplate>
                  </ItemsControl.ItemTemplate>
                </ItemsControl>

                <!-- Quick actions -->
                <Separator Margin="0,8,0,8"/>
                <TextBlock Text="Quick actions" FontWeight="SemiBold"/>
                <StackPanel Orientation="Horizontal" Margin="0,4,0,4">
                  <TextBlock Text="UserId:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                  <TextBox Width="260" Text="{Binding NewParticipantUserIdText, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                  <TextBlock Text="or Name:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                  <TextBox Width="180" Text="{Binding NewParticipantDisplayName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                  <Button Content="Add participant" Command="{Binding AddParticipantCommand}" Width="120"/>
                  <Button Content="Add placeholder" Command="{Binding AddPlaceholderParticipantCommand}" Width="130" Margin="8,0,0,0"/>
                </StackPanel>
                <!-- Propose date/destination removed from Overview per request -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                  <Button Content="Copy invite link" Command="{Binding CopyInviteLinkCommand}" Width="140"/>
                </StackPanel>

                <Separator Margin="0,8,0,8"/>

                <TextBlock Text="Description" FontWeight="SemiBold"/>
                <TextBox Text="{Binding DescriptionMarkdown, UpdateSourceTrigger=PropertyChanged}"
                         AcceptsReturn="True" TextWrapping="Wrap" Height="140"
                         IsReadOnly="{Binding IsOverviewReadOnly}"/>

                <CheckBox Content="Is finished" IsChecked="{Binding SelectedTripIsFinished, Mode=TwoWay}"
                          Margin="0,8,0,0" IsEnabled="{Binding IsEditingOverview}"/>
              </StackPanel>

              <!-- Save button -->
              <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,8,0,0">
                <Button Content="Save" Command="{Binding SaveOverviewCommand}" Width="120">
                  <Button.Style>
                    <Style TargetType="Button">
                      <Setter Property="Visibility" Value="Collapsed"/>
                      <Style.Triggers>
                        <DataTrigger Binding="{Binding IsEditingOverview}" Value="True">
                          <Setter Property="Visibility" Value="Visible"/>
                        </DataTrigger>
                      </Style.Triggers>
                    </Style>
                  </Button.Style>
                </Button>
              </StackPanel>
            </Grid>
          </TabItem>

          <TabItem Header="Destination">
            <StackPanel DataContext="{Binding DestinationsVm}">
              <TextBlock Text="Destination Proposals" FontWeight="Bold" FontSize="16"/>
              <TextBlock Text="Propose, list, and vote for trip destinations." FontSize="12" Foreground="Gray" Margin="0,2,0,12"/>

              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <Button Content="Refresh" Command="{Binding RefreshCommand}" Width="90"/>
                <TextBlock Text="{Binding Status}" Margin="12,0,0,0" VerticalAlignment="Center" Foreground="Gray"/>
              </StackPanel>

              <DataGrid ItemsSource="{Binding Destinations}"
                        AutoGenerateColumns="False" IsReadOnly="True"
                        Height="200" Margin="0,4,0,8"
                        SelectedItem="{Binding SelectedDestination, Mode=TwoWay}">
                <DataGrid.Columns>
                  <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="2*"/>
                  <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="2*"/>
                  <DataGridTextColumn Header="Votes" Binding="{Binding Votes}" Width="Auto"/>
                </DataGrid.Columns>
              </DataGrid>

              <TextBlock Text="Propose destination" FontWeight="SemiBold" Margin="0,8,0,4"/>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                <TextBlock Text="Title:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="260" Text="{Binding NewTitle, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                <TextBlock Text="Description:" VerticalAlignment="Center" Margin="12,0,6,0"/>
                <TextBox Width="320" Text="{Binding NewDescription, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                <Button Content="Propose" Command="{Binding ProposeCommand}" Width="100"/>
              </StackPanel>

              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Image URLs (comma or newline separated):" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="620" AcceptsReturn="True" TextWrapping="Wrap"
                         Text="{Binding NewImagesRaw, UpdateSourceTrigger=PropertyChanged}" />
              </StackPanel>

              <Separator Margin="0,8,0,8"/>

              <TextBlock Text="Vote" FontWeight="SemiBold" Margin="0,0,0,4"/>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                <TextBlock Text="Vote as user:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="320" Text="{Binding VoteUserId, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                <Button Content="Vote on selected destination" Command="{Binding VoteCommand}"/>
              </StackPanel>
            </StackPanel>
          </TabItem>

          <TabItem Header="Trasy &amp; Jízdenky">
            <!-- GPX/JSON import, PDF/image upload list -->
          </TabItem>

          <TabItem Header="Denní plán">
            <!-- Start/End location, POIs list, 'Optimalizovat den' button, map placeholder -->
          </TabItem>

          <TabItem Header="Vybavení">
            <!-- Gear list, assignments to participants, shared items -->
          </TabItem>

          <TabItem Header="Finance">
            <!-- Expenses list, add expense dialog, 'Vyrovnat' summary, Export CSV -->
          </TabItem>

          <TabItem Header="Deník">
            <!-- Daily entries with text/photos/ratings -->
          </TabItem>

        </TabControl>
      </Grid>

      <!-- Busy overlay -->
      <Border Grid.RowSpan="3" Background="#40FFFFFF">
        <Border.Style>
          <Style TargetType="Border">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
              <DataTrigger Binding="{Binding Busy}" Value="True">
                <Setter Property="Visibility" Value="Visible"/>
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </Border.Style>

        <TextBlock Text="Working..." HorizontalAlignment="Center" VerticalAlignment="Center"
                   FontSize="18" FontWeight="Bold"/>
      </Border>
    </Grid>
  </DockPanel>
</Window>
