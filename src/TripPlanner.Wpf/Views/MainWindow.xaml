<Window x:Class="TripPlanner.Wpf.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="TripPlanner" Height="620" Width="980">
  <DockPanel>
    <!-- Menu bar -->
    <Menu DockPanel.Dock="Top">
      <MenuItem Header="_Account">
        <MenuItem Header="Sign out" Click="OnSignOut"/>
      </MenuItem>
    </Menu>
    <Grid Margin="12">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
        <RowDefinition Height="Auto"/>
      </Grid.RowDefinitions>
      
      <!-- Create trip -->
      <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
        <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,6,0"/>
        <TextBox Width="240" Text="{Binding NewTripName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,12,0"/>
        <TextBlock Text="OrganizerId:" VerticalAlignment="Center" Margin="0,0,6,0"/>
        <TextBox Width="320" Text="{Binding OrganizerId, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,12,0"/>
        <Button Content="Create Trip" Command="{Binding CreateTripCommand}" />
        <Button Content="Refresh" Command="{Binding RefreshCommand}" Margin="8,0,0,0"/>
        <TextBlock Text="{Binding Status}" Margin="12,0,0,0" VerticalAlignment="Center" Foreground="DarkSlateGray"/>
      </StackPanel>

      <!-- List + Details -->
      <Grid Grid.Row="1">
        <Grid.ColumnDefinitions>
          <ColumnDefinition Width="*"/>
          <ColumnDefinition Width="2*"/>
        </Grid.ColumnDefinitions>

        <!-- Trips -->
        <DataGrid Grid.Column="0" ItemsSource="{Binding Trips}" SelectedItem="{Binding SelectedTrip}"
                  AutoGenerateColumns="False" IsReadOnly="True" Margin="0,0,8,0">
          <DataGrid.Columns>
            <DataGridTextColumn Header="Id" Binding="{Binding TripId}" Width="2*"/>
            <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
          </DataGrid.Columns>
        </DataGrid>

        <!-- Right panel -->
        <TabControl Grid.Column="1"
                    SelectedIndex="{Binding SelectedSectionIndex}">

          <TabItem Header="Overview &amp; Date">
            <StackPanel>
              <TextBlock Text="Trip Summary" FontWeight="Bold" FontSize="16"/>
              <TextBlock Text="{Binding SelectedSummary.Name}" FontSize="14" Margin="0,2,0,12"/>

              <TextBlock Text="Participants" FontWeight="SemiBold"/>
              <ItemsControl ItemsSource="{Binding SelectedSummary.Participants}">
                <ItemsControl.ItemTemplate>
                  <DataTemplate><TextBlock Text="{Binding}"/></DataTemplate>
                </ItemsControl.ItemTemplate>
              </ItemsControl>

              <Separator Margin="0,8,0,8"/>

              <TextBlock Text="Date Options" FontWeight="SemiBold"/>
              <DataGrid ItemsSource="{Binding SelectedSummary.DateOptions}"
                        AutoGenerateColumns="False" IsReadOnly="True"
                        Height="160" Margin="0,4,0,4"
                        SelectedValuePath="DateOptionId"
                        SelectedValue="{Binding SelectedDateOptionId}">
                <DataGrid.Columns>
                  <DataGridTextColumn Header="Id" Binding="{Binding DateOptionId}" Width="2*"/>
                  <DataGridTextColumn Header="Date" Binding="{Binding Date}" Width="*"/>
                  <DataGridTextColumn Header="Votes" Binding="{Binding VotesCount}" Width="Auto"/>
                </DataGrid.Columns>
              </DataGrid>

              <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                <TextBlock Text="New participant:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="320" Text="{Binding NewParticipantUserId, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                <Button Content="Add" Command="{Binding AddParticipantCommand}"/>
              </StackPanel>

              <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                <TextBlock Text="Propose date:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <DatePicker SelectedDate="{Binding NewDate, Mode=TwoWay}" Margin="0,0,8,0"/>
                <Button Content="Propose" Command="{Binding ProposeDateCommand}"/>
              </StackPanel>

              <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
                <TextBlock Text="Vote as user:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="320" Text="{Binding VoteUserId, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                <Button Content="Vote on selected date" Command="{Binding CastVoteCommand}"/>
              </StackPanel>
            </StackPanel>
          </TabItem>

          <TabItem Header="Destination">
            <StackPanel DataContext="{Binding DestinationsVm}">
              <TextBlock Text="Destination Proposals" FontWeight="Bold" FontSize="16"/>
              <TextBlock Text="Propose, list, and vote for trip destinations." FontSize="12" Foreground="Gray" Margin="0,2,0,12"/>

              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <Button Content="Refresh" Command="{Binding RefreshCommand}" Width="90"/>
                <TextBlock Text="{Binding Status}" Margin="12,0,0,0" VerticalAlignment="Center" Foreground="Gray"/>
              </StackPanel>

              <DataGrid ItemsSource="{Binding Destinations}"
                        AutoGenerateColumns="False" IsReadOnly="True"
                        Height="200" Margin="0,4,0,8"
                        SelectedValue="{Binding SelectedDestinationId}">
                <DataGrid.Columns>
                  <DataGridTextColumn Header="Title" Binding="{Binding Title}" Width="2*"/>
                  <DataGridTextColumn Header="Description" Binding="{Binding Description}" Width="2*"/>
                  <DataGridTextColumn Header="Votes" Binding="{Binding Votes}" Width="Auto"/>
                </DataGrid.Columns>
              </DataGrid>

              <TextBlock Text="Propose destination" FontWeight="SemiBold" Margin="0,8,0,4"/>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,4">
                <TextBlock Text="Title:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="260" Text="{Binding NewTitle, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                <TextBlock Text="Description:" VerticalAlignment="Center" Margin="12,0,6,0"/>
                <TextBox Width="320" Text="{Binding NewDescription, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                <Button Content="Propose" Command="{Binding ProposeCommand}" Width="100"/>
              </StackPanel>

              <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                <TextBlock Text="Image URLs (comma or newline separated):" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="620" AcceptsReturn="True" TextWrapping="Wrap"
                         Text="{Binding NewImagesRaw, UpdateSourceTrigger=PropertyChanged}" />
              </StackPanel>

              <Separator Margin="0,8,0,8"/>

              <TextBlock Text="Vote" FontWeight="SemiBold" Margin="0,0,0,4"/>
              <StackPanel Orientation="Horizontal" Margin="0,0,0,0">
                <TextBlock Text="Vote as user:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox Width="320" Text="{Binding VoteUserId, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
                <Button Content="Vote on selected destination" Command="{Binding VoteCommand}"/>
              </StackPanel>
            </StackPanel>
          </TabItem>

          <TabItem Header="Trasy &amp; Jízdenky">
            <!-- GPX/JSON import, PDF/image upload list -->
          </TabItem>

          <TabItem Header="Denní plán">
            <!-- Start/End location, POIs list, 'Optimalizovat den' button, map placeholder -->
          </TabItem>

          <TabItem Header="Vybavení">
            <!-- Gear list, assignments to participants, shared items -->
          </TabItem>

          <TabItem Header="Finance">
            <!-- Expenses list, add expense dialog, 'Vyrovnat' summary, Export CSV -->
          </TabItem>

          <TabItem Header="Deník">
            <!-- Daily entries with text/photos/ratings -->
          </TabItem>

        </TabControl>
      </Grid>

      <!-- Busy overlay -->
      <Border Grid.RowSpan="3" Background="#40FFFFFF">
        <Border.Style>
          <Style TargetType="Border">
            <Setter Property="Visibility" Value="Collapsed"/>
            <Style.Triggers>
              <DataTrigger Binding="{Binding Busy}" Value="True">
                <Setter Property="Visibility" Value="Visible"/>
              </DataTrigger>
            </Style.Triggers>
          </Style>
        </Border.Style>

        <TextBlock Text="Working..." HorizontalAlignment="Center" VerticalAlignment="Center"
                   FontSize="18" FontWeight="Bold"/>
      </Border>
    </Grid>
  </DockPanel>
</Window>
