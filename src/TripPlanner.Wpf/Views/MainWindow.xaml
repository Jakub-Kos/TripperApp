<Window x:Class="TripPlanner.Wpf.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="TripPlanner" Height="620" Width="980">
  <Grid Margin="12">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    
    <!-- Create trip -->
    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
      <TextBlock Text="Name:" VerticalAlignment="Center" Margin="0,0,6,0"/>
      <TextBox Width="240" Text="{Binding NewTripName, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,12,0"/>
      <TextBlock Text="OrganizerId:" VerticalAlignment="Center" Margin="0,0,6,0"/>
      <TextBox Width="320" Text="{Binding OrganizerId, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,12,0"/>
      <Button Content="Create Trip" Command="{Binding CreateTripCommand}" />
      <Button Content="Refresh" Command="{Binding RefreshCommand}" Margin="8,0,0,0"/>
      <TextBlock Text="{Binding Status}" Margin="12,0,0,0" VerticalAlignment="Center" Foreground="DarkSlateGray"/>
    </StackPanel>

    <!-- List + Details -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="2*"/>
      </Grid.ColumnDefinitions>

      <!-- Trips -->
      <DataGrid Grid.Column="0" ItemsSource="{Binding Trips}" SelectedItem="{Binding SelectedTrip}"
                AutoGenerateColumns="False" IsReadOnly="True" Margin="0,0,8,0">
        <DataGrid.Columns>
          <DataGridTextColumn Header="Id" Binding="{Binding TripId}" Width="2*"/>
          <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
        </DataGrid.Columns>
      </DataGrid>

      <!-- Summary -->
      <StackPanel Grid.Column="1">
        <TextBlock Text="Trip Summary" FontWeight="Bold" FontSize="16"/>
        <TextBlock Text="{Binding SelectedSummary.Name}" FontSize="14" Margin="0,2,0,12"/>

        <TextBlock Text="Participants" FontWeight="SemiBold"/>
        <ItemsControl ItemsSource="{Binding SelectedSummary.Participants}">
          <ItemsControl.ItemTemplate>
            <DataTemplate><TextBlock Text="{Binding}"/></DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>

        <Separator Margin="0,8,0,8"/>

        <TextBlock Text="Date Options" FontWeight="SemiBold"/>
        <DataGrid ItemsSource="{Binding SelectedSummary.DateOptions}" AutoGenerateColumns="False" IsReadOnly="True" Height="160" Margin="0,4,0,4"
                  SelectedValuePath="DateOptionId" SelectedValue="{Binding SelectedDateOptionId}">
          <DataGrid.Columns>
            <DataGridTextColumn Header="Id" Binding="{Binding DateOptionId}" Width="2*"/>
            <DataGridTextColumn Header="Date" Binding="{Binding Date}" Width="*" />
            <DataGridTextColumn Header="Votes" Binding="{Binding VotesCount}" Width="Auto" />
          </DataGrid.Columns>
        </DataGrid>

        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
          <TextBlock Text="New participant:" VerticalAlignment="Center" Margin="0,0,6,0"/>
          <TextBox Width="320" Text="{Binding NewParticipantUserId, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
          <Button Content="Add" Command="{Binding AddParticipantCommand}"/>
        </StackPanel>

        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
          <TextBlock Text="Propose date:" VerticalAlignment="Center" Margin="0,0,6,0"/>
          <DatePicker SelectedDate="{Binding NewDate, Mode=TwoWay}" Margin="0,0,8,0"/>
          <Button Content="Propose" Command="{Binding ProposeDateCommand}"/>
        </StackPanel>

        <StackPanel Orientation="Horizontal" Margin="0,8,0,0">
          <TextBlock Text="Vote as user:" VerticalAlignment="Center" Margin="0,0,6,0"/>
          <TextBox Width="320" Text="{Binding VoteUserId, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,8,0"/>
          <Button Content="Vote on selected date" Command="{Binding CastVoteCommand}"/>
        </StackPanel>

      </StackPanel>
    </Grid>

    <!-- Busy overlay -->
    <Border Grid.RowSpan="3" Background="#40FFFFFF">
      <Border.Style>
        <Style TargetType="Border">
          <Setter Property="Visibility" Value="Collapsed"/>
          <Style.Triggers>
            <DataTrigger Binding="{Binding Busy}" Value="True">
              <Setter Property="Visibility" Value="Visible"/>
            </DataTrigger>
          </Style.Triggers>
        </Style>
      </Border.Style>

      <TextBlock Text="Working..." HorizontalAlignment="Center" VerticalAlignment="Center"
                 FontSize="18" FontWeight="Bold"/>
    </Border>
  </Grid>
</Window>
