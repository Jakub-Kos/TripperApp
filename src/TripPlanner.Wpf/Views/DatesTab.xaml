<UserControl x:Class="TripPlanner.Wpf.Views.DatesTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:conv="clr-namespace:TripPlanner.Wpf.Converters">
  <UserControl.Resources>
    <BooleanToVisibilityConverter x:Key="BoolToVis"/>
    <conv:PercentToBrushConverter x:Key="PctToBrush"/>
    <conv:BoolToThicknessConverter x:Key="BoolToThick" TrueThickness="2" FalseThickness="0"/>
  </UserControl.Resources>

  <Grid Margin="8">
    <Grid.ColumnDefinitions>
      <ColumnDefinition Width="*"/>
      <ColumnDefinition Width="12"/>
      <ColumnDefinition Width="1.1*"/>
    </Grid.ColumnDefinitions>

    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- Range & voter -->
    <StackPanel Grid.Column="0" Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,6">
      <TextBlock Text="Date range:" VerticalAlignment="Center" Margin="0,0,6,0"/>
      <DatePicker SelectedDate="{Binding RangeStart}" Width="150" Margin="0,0,6,0"/>
      <TextBlock Text=" – " VerticalAlignment="Center"/>
      <DatePicker SelectedDate="{Binding RangeEnd}" Width="150" Margin="6,0,6,0"/>
      <Button Content="Save range" Command="{Binding SaveRangeCommand}" />
    </StackPanel>

    <StackPanel Grid.Column="0" Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
      <TextBlock Text="Vote as:" VerticalAlignment="Center" Margin="0,0,6,0"/>
      <ComboBox Width="220" ItemsSource="{Binding VoterOptions}" SelectedItem="{Binding SelectedVoter}" />
    </StackPanel>

    <!-- Calendar -->
    <DockPanel Grid.Column="0" Grid.Row="2">
      <!-- Header: days of week -->
      <UniformGrid DockPanel.Dock="Top" Columns="7" Margin="0,0,0,4">
        <TextBlock Text="Mon" Opacity="0.6" HorizontalAlignment="Center"/>
        <TextBlock Text="Tue" Opacity="0.6" HorizontalAlignment="Center"/>
        <TextBlock Text="Wed" Opacity="0.6" HorizontalAlignment="Center"/>
        <TextBlock Text="Thu" Opacity="0.6" HorizontalAlignment="Center"/>
        <TextBlock Text="Fri" Opacity="0.6" HorizontalAlignment="Center"/>
        <TextBlock Text="Sat" Opacity="0.6" HorizontalAlignment="Center"/>
        <TextBlock Text="Sun" Opacity="0.6" HorizontalAlignment="Center"/>
      </UniformGrid>

      <ScrollViewer VerticalScrollBarVisibility="Auto">
        <ItemsControl ItemsSource="{Binding CalendarDays}">
          <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
              <UniformGrid Columns="7"/>
            </ItemsPanelTemplate>
          </ItemsControl.ItemsPanel>
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <Border Margin="2"
                      CornerRadius="6"
                      Background="{Binding VotePercent, Converter={StaticResource PctToBrush}}">
                <Border.Style>
                  <Style TargetType="Border">
                    <Setter Property="Opacity" Value="1"/>
                    <Style.Triggers>
                      <DataTrigger Binding="{Binding InRange}" Value="False">
                        <Setter Property="Opacity" Value="0.35"/>
                      </DataTrigger>
                    </Style.Triggers>
                  </Style>
                </Border.Style>
                <Grid>
                  <!-- Click surface -->
                  <Button Command="{Binding DataContext.ToggleDayCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                          CommandParameter="{Binding}"
                          Background="Transparent" BorderThickness="0" Cursor="Hand"/>

                  <!-- Day number -->
                  <TextBlock Text="{Binding Date, StringFormat={}{0:dd}}"
                             Margin="6" VerticalAlignment="Top" HorizontalAlignment="Left" FontWeight="SemiBold"/>

                  <!-- Vote count bottom-right -->
                  <Border HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="4"
                          Background="#66000000" CornerRadius="10" Padding="6,2">
                    <TextBlock Text="{Binding VoteCount}" Foreground="White" FontSize="11"/>
                  </Border>

                  <!-- Selected voter highlight -->
                  <Border BorderBrush="#FF2D7D46"
                          BorderThickness="{Binding IsSelectedVoterVoted, Converter={StaticResource BoolToThick}}"
                          CornerRadius="6"/>
                </Grid>
              </Border>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </DockPanel>

    <!-- Right column: term proposals (keep existing pattern) -->
    <GroupBox Grid.Column="2" Grid.Row="0" Grid.RowSpan="3" Header="Term proposals">
      <DockPanel Margin="8">
        <StackPanel Orientation="Horizontal" DockPanel.Dock="Top" Margin="0,0,0,8">
          <TextBlock Text="New term:" VerticalAlignment="Center" Margin="0,0,8,0"/>
          <DatePicker SelectedDate="{Binding ProposedStart}" Width="150" Margin="0,0,6,0"/>
          <TextBlock Text=" – " VerticalAlignment="Center"/>
          <DatePicker SelectedDate="{Binding ProposedEnd}" Width="150" Margin="6,0,8,0"/>
          <Button Content="Propose" Command="{Binding ProposeTermCommand}" />
        </StackPanel>

        <ListView ItemsSource="{Binding Terms}" BorderThickness="0">
          <ListView.ItemTemplate>
            <DataTemplate>
              <DockPanel Margin="0,4,0,4">
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right">
                  <Button Content="Vote" Margin="0,0,6,0"
                          Command="{Binding DataContext.VoteTermCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                          CommandParameter="{Binding}"/>
                  <Button Content="Unvote" Margin="0,0,6,0"
                          Command="{Binding DataContext.UnvoteTermCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                          CommandParameter="{Binding}"/>
                  <Button Content="Choose"
                          Command="{Binding DataContext.ChooseTermCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                          CommandParameter="{Binding}"/>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                  <TextBlock Text="{Binding Start}" Margin="0,0,4,0"/>
                  <TextBlock Text="–" Margin="0,0,4,0"/>
                  <TextBlock Text="{Binding End}" Margin="0,0,12,0"/>
                  <TextBlock Text="{Binding Votes, StringFormat=Votes: {0}}" Margin="0,0,8,0"/>
                  <TextBlock Text="Chosen" Foreground="SeaGreen" Visibility="{Binding IsChosen, Converter={StaticResource BoolToVis}}"/>
                </StackPanel>
              </DockPanel>
            </DataTemplate>
          </ListView.ItemTemplate>
        </ListView>
      </DockPanel>
    </GroupBox>

    <TextBlock Grid.Column="0" Grid.Row="3" Foreground="Gray"
               Text="Tip: set the overall range, select who you vote as, then click days to toggle your availability. More green = more people available."/>
  </Grid>
</UserControl>
